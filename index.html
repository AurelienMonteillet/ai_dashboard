<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adaptive Issuance Dashboard</title>
  <!-- Favicon and stylesheets -->
  <link rel="icon" href="favicon.ico">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/main.css">
  <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@400;700&display=swap" rel="stylesheet">
  <!-- Highcharts libraries for chart rendering -->
  <script src="js/highcharts.js"></script>
  <script src="js/highcharts-more.js"></script>
  <script src="js/draggable-points.js"></script>
  <style>
    /* Inline fallback for background gradient */
    body { background: radial-gradient(50% 50% at 65% 50%, rgba(36, 26, 76, 1) 0%, rgba(9, 3, 28, 1) 100%); }
    .container { margin-top: 60px; }
  </style>
</head>
<body>
  <!-- Header with Tezos logo and title -->
  <header class="tezos-header">
    <img src="public/tezos-logo-white.svg" alt="Tezos Logo" class="tezos-logo">
    <span class="tezos-title">Tezos</span>
  </header>
  <!-- Main dashboard container -->
  <div class="container scrollable-content">
    <div class="row">
      <div class="col-lg-12">
        <div class="title-section">
          <h1 class="hero-cursive-title">Ai Dashboard</h1>
        </div>
      </div>
    </div>
    <div class="row">
      <!-- Left chart: Staking ratio -->
      <div class="col-lg-6">
        <figure class="highcharts-figure chart-placeholder">
          <div id="stakingh">Loading...</div>
        </figure>
      </div>
      <!-- Right chart: Issuance ratio -->
      <div class="col-lg-6">
        <figure class="highcharts-figure chart-placeholder">
          <div id="issuanceh">Loading...</div>
        </figure>
      </div>
    </div>
  </div>
  <!-- Main JS logic for data fetching and chart rendering -->
  <script src="js/main.js"></script>
  <script>
    // Ensure scroll position resets to top when switching from mobile to desktop
    let lastIsMobile = window.innerWidth <= 768;
    window.addEventListener('resize', function() {
      const isMobile = window.innerWidth <= 768;
      if (lastIsMobile && !isMobile) {
        window.scrollTo(0, 0);
      }
      lastIsMobile = isMobile;
    });
  </script>
  <script>
    // Loads data and initializes both dashboards
    (async function() {
      if (typeof fetchAggregatedData !== 'function') {
        alert('main.js not loaded correctly');
        return;
      }
      try {
        aggregatedDataCache = await fetchAggregatedData();
        // Get historical ratios for projection
        let ratios = [];
        let last = 0;
        const data = aggregatedDataCache.historicalCycleData;
        const startCycle = 748; // AI_ACTIVATION_CYCLE
        const relevantData = data.filter(cycleData => cycleData.cycle >= startCycle);
        relevantData.forEach(cycleData => {
          const ratio = cycleData.totalFrozen / cycleData.totalSupply;
          ratios.push(ratio);
          last = ratio;
        });
        // Project 50 more cycles
        for (let i = 0; i < 50; i++) {
          ratios.push(last);
        }
        createHistoricalCharts(ratios);
      } catch (e) {
        document.getElementById('stakingh').innerText = 'Loading error';
        document.getElementById('issuanceh').innerText = 'Loading error';
      }
    })();
  </script>
  <!-- Powered by footer -->
  <div class="powered-footer-xtzchads">
    Powered by <a href="https://tez.cool/" target="_blank" rel="noopener" class="powered-link-xtzchads">xtzchads</a>
  </div>
</body>
</html> 